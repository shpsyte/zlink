function AddNewLi(ul,id,text,classs){let li=NewElement("li");li.appendChild(NewText(text));li.setAttribute("data-mobile-id",id);li.setAttribute("class",classs);ul.appendChild(li)}function ToggleSpiner(behavior){let loading=GetOne("#loading");loading!==null&&(behavior==="hide"?loading.classList.add("hide"):loading.classList.remove("hide"))}function _get(url,callback,errorcallback){ToggleSpiner("show");$.ajax({type:"GET",url:url,error:function(data){typeof errorcallback!="undefined"&&errorcallback(data)},success:function(data){typeof callback!="undefined"&&callback(data)},dataType:"json"});ToggleSpiner("hide")}function _post(url,data,callback,errorcallback){var token=GetOne("input[name=__RequestVerificationToken]").value;ToggleSpiner("show");$.ajax({type:"POST",headers:{RequestVerificationToken:token},url:url,data:data,error:function(data){typeof errorcallback!="undefined"&&errorcallback(data)},success:function(data){typeof callback!="undefined"&&callback(data)},dataType:"json"});ToggleSpiner("hide")}function RegisterTag(){function RegisterClickOnTag(){event.preventDefault();let id=this.getAttribute("data-id"),url=this.getAttribute("data-url"),targetLink=this.getAttribute("href"),data={id};_post(url,data);window.open(targetLink,"_blank")}let tags=GetAll(".tag-register");for(let tag of tags)tag.addEventListener("mousedown",RegisterClickOnTag)}function Listening(){function ConectToServer(){Print("trying connect...");connection.start().then(HandleNewConnection()).catch(function(err){return console.error(err.toString())})}function HandleNewConnection(){Print("listening...");idTime!==null&&clearTimeout(idTime)}var idTime,connection=(new signalR.HubConnectionBuilder).withUrl("/newTagHub").build();ConectToServer();connection.on("NewTagAdd",function(data){UpdateLinkElement(data)});connection.onclose(()=>{idTime=setTimeout(ConectToServer,5e3)})}function AreaChart(){function drawChart(){var id=GetOne("#Id").value,url=GetOne("#url").value+"/"+id;_get(url,success)}function success(data){var dataCol=new google.visualization.DataTable,options,chart;for(dataCol.addColumn("string","Date"),dataCol.addColumn("number","Access"),i=0;i<data.length;i++)dataCol.addRow([data[i].key,data[i].qtd]);options={title:"Access By Day",hAxis:{title:"Days",titleTextStyle:{color:"#333"}},vAxis:{minValue:0,scaleType:"int",format:"#"},legend:"none"};chart=new google.visualization.AreaChart(document.getElementById("chart_div"));chart.draw(dataCol,options)}google.charts.load("current",{packages:["corechart"]});google.charts.setOnLoadCallback(drawChart)}function SetupCreateLink(){function CreateTag(data){CreateElementForTag(data);CreateElementForMobile(data)}function CreateElementForTag(data){let total=GetOne("#TotalTags"),nextItem=total.value;++nextItem;let linkDto=data.data,divLinks=GetOne(".links"),url=GetOne("#url").value,divDataInput=NewElement("div");divDataInput.setAttribute("class","data-input");let button=NewElement("button");button.setAttribute("value","update");button.setAttribute("data-key",nextItem);button.setAttribute("data-type","update");button.setAttribute("data-id",linkDto.id);button.setAttribute("data-url",url);button.setAttribute("class","btn g-bg-primary rounded-0");button.appendChild(NewText("Update"));button.onclick=UpdateTag;let inputName=NewElement("input");inputName.setAttribute("type","text");inputName.setAttribute("data-key",nextItem);inputName.setAttribute("data-name","");inputName.setAttribute("value",linkDto.name);inputName.setAttribute("class","form-control form-control-xs rounded-0");inputName.value=linkDto.name;let inputLink=NewElement("input");inputLink.setAttribute("type","text");inputLink.setAttribute("data-key",nextItem);inputLink.setAttribute("data-link","");inputLink.setAttribute("value",linkDto.targetLink);inputLink.setAttribute("class","form-control form-control-xs rounded-0");inputLink.value=linkDto.targetLink;let i=NewElement("i");i.setAttribute("class","fa");i.setAttribute("data-check-icon","ï€Œ");let divIcon=NewElement("div");divIcon.setAttribute("class","u-check-icon-checkbox-v4 g-absolute-centered--y g-left-0");divIcon.appendChild(i);let inputActive=NewElement("input");inputActive.setAttribute("type","checkbox");inputActive.setAttribute("data-key",nextItem);inputActive.setAttribute("data-active","");inputActive.setAttribute("data-type","update");inputActive.setAttribute("data-url",url);inputActive.setAttribute("data-id",linkDto.id);inputActive.setAttribute("id",nextItem);inputActive.setAttribute("value",!0);inputActive.setAttribute("checked",!0);inputActive.setAttribute("class","g-hidden-xs-up g-pos-abs g-top-0 g-left-0");inputActive.checked=linkDto.active;inputActive.onclick=UpdateTag;let labelItem=NewElement("label");labelItem.setAttribute("class","u-check g-pl-25");labelItem.appendChild(divIcon);labelItem.appendChild(inputActive);let divActive=NewElement("div");divActive.setAttribute("class","form-group g-mb-0 d-flex align-items-center");divActive.appendChild(labelItem);divDataInput.appendChild(button);divDataInput.appendChild(inputName);divDataInput.appendChild(inputLink);divDataInput.appendChild(divActive);divLinks.prepend(divDataInput);total.value=nextItem}function CreateElementForMobile(data){let url="/app-get-link/"+data.username;_get(url,function(data){GetOne(".view-link").innerHTML=data.responseText},function(data){GetOne(".view-link").innerHTML=data.responseText})}function UpdateTag(){event.preventDefault();let btn=this,url=btn.getAttribute("data-url"),key=btn.getAttribute("data-key"),id=btn.getAttribute("data-id"),name=GetOne(`input[data-name][data-key="${key}"] `).value,targetlink=GetOne(`input[data-link][data-key="${key}"] `).value,active=GetOne(`input[data-active][data-key="${key}"] `).checked,data={id,name,targetlink,active,key};_post(url,data,UpdateTagSucceful)}function UpdateTagSucceful(data){let linkDto=data.data,key=linkDto.key,name=GetOne(`input[data-name][data-key="${key}"] `),targetlink=GetOne(`input[data-link][data-key="${key}"] `),active=GetOne(`input[data-active][data-key="${key}"] `);name.value=linkDto.name;targetlink.value=linkDto.targetLink;active.checked=linkDto.active;UpdateMobile(linkDto.id,linkDto.name,linkDto.active)}function UpdateMobile(id,name,activeItem){let li=GetOne(`li[data-mobile-id="${id}"]`);if(li!==null)activeItem?li.innerHTML=name:li.parentNode.removeChild(li);else{let ul=GetOne("#mobile");AddNewLi(ul,id,name,"btn btn-md u-btn-primary")}}let add=document.querySelector("#add");add.addEventListener("click",()=>{this.disabled=!0;event.preventDefault();let name=GetOne("#Name").value,targetlink=GetOne("#TargetLink").value,url=add.getAttribute("data-url"),data={name,targetlink};_post(url,data,CreateTag);this.disabled=!1});let btnUpdate=GetAll('*[data-type="update"]');for(const btn of btnUpdate)btn.addEventListener("click",UpdateTag)}function SetupDashBoard(){function DrawGraph(data){GetOne("#name").innerHTML=data.name;GetOne("#totalClick").innerHTML=data.stats.totalClicks;GetOne("#totalUniqueClick").innerHTML=data.stats.totalUniqueClicks;let clickByDay=data.stats.clicksByDay,clicksByMonth=data.stats.clicksByMonth,clicksByYear=data.stats.clicksByYear,clicksByRegion=data.stats.clicksByRegion,clicksByCity=data.stats.clicksByCity,clicks=data.stats.clicks;drawChart(clickByDay,"Days","Access By Day","#byday");drawChart(clicksByMonth,"Month","Access By Month","#bymonth");drawChart(clicksByYear,"Year","Access By Year","#byyear");drawChart(clicksByRegion,"Region","Access By Region","#byregion");drawChart(clicksByCity,"City","Access By City","#bycity");drawTable(clicks)}function drawTable(data){let dataTable=[];for(i=0;i<data.length;i++)dataTable.push([data[i].country,new Date(data[i].data).toLocaleDateString("pt-Br"),data[i].postalCode,data[i].regionName,data[i].city]);let table=$("#clicks").DataTable({retrieve:!0,data:dataTable});table.destroy();table=$("#clicks").DataTable({retrieve:!0,data:dataTable})}function drawChart(data,column,title,divToGraph){google.charts.load("current",{packages:["corechart"]});google.charts.setOnLoadCallback(function(){var dataTable=new google.visualization.DataTable,options,chart;for(dataTable.addColumn("string",column),dataTable.addColumn("number","Clicks"),i=0;i<data.length;i++)dataTable.addRow([data[i].key,data[i].qtd]);options={title:title,hAxis:{title:column,titleTextStyle:{color:"#333"}},vAxis:{minValue:0,scaleType:"int",format:"#"},legend:"none"};chart=new google.visualization.ColumnChart(GetOne(divToGraph));chart.draw(dataTable,options)})}var d=function(id){let url=GetOne("#url").value+"/"+id;_get(url,DrawGraph)};GetOne("#Id").addEventListener("change",function(){d(this.value)})}var GetOne=document.querySelector.bind(document),GetAll=document.querySelectorAll.bind(document),Print=console.log.bind(document),NewElement=document.createElement.bind(document),NewText=document.createTextNode.bind(document);